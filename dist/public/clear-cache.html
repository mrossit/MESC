<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpar Cache - MESC</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        button {
            background: #9E978A;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .log {
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Utilit√°rio de Limpeza de Cache - MESC</h1>
        
        <p>Use esta ferramenta para for√ßar a atualiza√ß√£o completa do aplicativo:</p>
        
        <div style="margin: 20px 0;">
            <button onclick="clearAllCaches()">üóëÔ∏è Limpar Todos os Caches</button>
            <button onclick="unregisterServiceWorker()">üîÑ Remover Service Worker</button>
            <button onclick="forceReload()">‚ôªÔ∏è Recarregar For√ßado</button>
        </div>
        
        <div id="status" class="status"></div>
        <div id="log" class="log" style="display: none;"></div>
        
        <script>
            const log = (message) => {
                const logDiv = document.getElementById('log');
                logDiv.style.display = 'block';
                logDiv.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            };
            
            const showStatus = (message, type = 'info') => {
                const status = document.getElementById('status');
                status.className = `status ${type}`;
                status.style.display = 'block';
                status.innerHTML = message;
            };
            
            async function clearAllCaches() {
                log('Iniciando limpeza de cache...');
                
                // Limpar localStorage
                try {
                    localStorage.clear();
                    log('‚úÖ localStorage limpo');
                } catch (e) {
                    log('‚ùå Erro ao limpar localStorage: ' + e.message);
                }
                
                // Limpar sessionStorage
                try {
                    sessionStorage.clear();
                    log('‚úÖ sessionStorage limpo');
                } catch (e) {
                    log('‚ùå Erro ao limpar sessionStorage: ' + e.message);
                }
                
                // Limpar caches do Service Worker
                if ('caches' in window) {
                    try {
                        const names = await caches.keys();
                        log(`Encontrados ${names.length} caches`);
                        
                        for (const name of names) {
                            await caches.delete(name);
                            log(`‚úÖ Cache "${name}" deletado`);
                        }
                    } catch (e) {
                        log('‚ùå Erro ao limpar caches: ' + e.message);
                    }
                }
                
                // Limpar cookies (limitado pelo navegador)
                try {
                    document.cookie.split(";").forEach((c) => {
                        document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                    });
                    log('‚úÖ Cookies limpos');
                } catch (e) {
                    log('‚ùå Erro ao limpar cookies: ' + e.message);
                }
                
                showStatus('‚úÖ Cache limpo com sucesso! Recarregando em 3 segundos...', 'success');
                setTimeout(() => window.location.href = '/', 3000);
            }
            
            async function unregisterServiceWorker() {
                log('Removendo Service Worker...');
                
                if ('serviceWorker' in navigator) {
                    try {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        log(`Encontrados ${registrations.length} Service Workers`);
                        
                        for (const registration of registrations) {
                            await registration.unregister();
                            log(`‚úÖ Service Worker removido: ${registration.scope}`);
                        }
                        
                        showStatus('‚úÖ Service Worker removido! Recarregando...', 'success');
                        setTimeout(() => window.location.reload(true), 2000);
                    } catch (e) {
                        log('‚ùå Erro ao remover Service Worker: ' + e.message);
                    }
                } else {
                    log('‚ö†Ô∏è Service Worker n√£o suportado neste navegador');
                }
            }
            
            function forceReload() {
                log('For√ßando recarga...');
                
                // Adicionar timestamp para evitar cache
                const timestamp = new Date().getTime();
                const newUrl = window.location.origin + '/?v=' + timestamp;
                
                showStatus('‚ôªÔ∏è Recarregando com nova vers√£o...', 'info');
                setTimeout(() => {
                    window.location.href = newUrl;
                }, 1000);
            }
            
            // Auto executar limpeza se vier com par√¢metro
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('auto') === 'true') {
                log('Modo autom√°tico ativado');
                clearAllCaches();
            }
        </script>
    </div>
</body>
</html>